version: "3.8"

services:
  apk-manager:
    image: "ghcr.io/nemovitostnik-h/droid-deploy:main"
    container_name: apk-manager
    restart: unless-stopped
    
    ports:
      - "${APP_PORT:-8580}:80"
    
    volumes:
      # Hlavní APK adresář (read-only)
      - ${APK_DATA_PATH:-./data/apk}:/data/apk:ro
      
      # Nebo můžeš mapovat jednotlivé platformy zvlášť:
      # - ${APK_DEV_PATH:-./data/apk/development}:/data/apk/development:ro
      # - ${APK_STAGING_PATH:-./data/apk/staging}:/data/apk/staging:ro
      # - ${APK_RC_PATH:-./data/apk/release-candidate}:/data/apk/release-candidate:ro
      # - ${APK_PROD_PATH:-./data/apk/production}:/data/apk/production:ro
    
    environment:
      # API konfigurace
      - VITE_API_BASE_URL=${API_BASE_URL:-http://localhost:3000/api}
      
      # Volitelné: Timezone pro správné časové značky
      - TZ=${TZ:-Europe/Prague}
    
    # Health check pro monitorování
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    
    # Logging konfigurace
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # Omezení zdrojů (volitelné, upravit podle serveru)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.5'
    #       memory: 256M

# Volitelně: Definice volumes pro lepší správu
# volumes:
#   apk-data:
#     driver: local
#     driver_opts:
#       type: none
#       o: bind
#       device: /home/jelly/docker/apk-manager

# Volitelně: Vlastní network
# networks:
#   apk-network:
#     driver: bridge
